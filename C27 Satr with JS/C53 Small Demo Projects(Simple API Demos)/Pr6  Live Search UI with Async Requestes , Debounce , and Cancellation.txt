<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Async Search UI</title>

    <style>
      :root {
        color-scheme: dark;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: #0b1020;
        color: #e9eefc;
        margin: 0;
        padding: 24px;
      }

      .app {
        max-width: 900px;
        margin: 0 auto;
      }

      .card {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 18px;
        padding: 20px;
      }

      h2 {
        margin: 0 0 10px;
      }

      p {
        margin: 0 0 16px;
        opacity: 0.8;
      }

      input {
        width: 100%;
        padding: 14px 16px;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(0, 0, 0, 0.25);
        color: #e9eefc;
        font-size: 16px;
        outline: none;
      }

      .status {
        margin-top: 12px;
        font-size: 14px;
        opacity: 0.8;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
        margin-top: 16px;
      }

      .item {
        padding: 14px;
        border-radius: 14px;
        background: rgba(0, 0, 0, 0.18);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .item strong {
        display: block;
        margin-bottom: 6px;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="card">
        <!--──────────────────────────────────────────────
      │ Code Overview
      │──────────────────────────────────────────────
      │ Purpose        → Real-time search UI using async/await
      │ Layout         → Single HTML file (modern UI)
      │ Use Cases      → Live search, debounce, cancel requests
      │ Key Properties → async/await, debounce, AbortController
      └──────────────────────────────────────────────-->

        <h2>Live User Search</h2>
        <p>
          Type a name to search users. Try letter L , or le  Requests are debounced and cancelled
          correctly.
        </p>

        <input
          id="searchInput"
          type="text"
          placeholder="Search users by name..."
          autocomplete="off"
        />

        <div class="status" id="status">Idle</div>

        <div class="grid" id="results"></div>
      </div>
    </div>

    <script>
      const input = document.getElementById("searchInput");
      const resultsEl = document.getElementById("results");
      const statusEl = document.getElementById("status");

      let debounceTimer = null;
      let currentController = null; // used to cancel previous requests

      // Render users to the UI
      function renderUsers(users) {
        resultsEl.innerHTML = users
          .map(
            (user) => `
        <div class="item">
          <strong>${user.name}</strong>
          <div>${user.email}</div>
        </div>
      `
          )
          .join("");
      }

      // Core async search function
      async function searchUsers(query) {
        // Cancel any previous in-flight request
        if (currentController) {
          currentController.abort();
        }

        // Create a new AbortController for this request
        currentController = new AbortController();

        statusEl.textContent = "Searching...";
        resultsEl.innerHTML = "";

        try {
          const response = await fetch(
            "https://jsonplaceholder.typicode.com/users",
            { signal: currentController.signal }
          );

          if (!response.ok) {
            throw new Error("Server error");
          }

          const users = await response.json();

          // Simple client-side filtering
          const filtered = users.filter((user) =>
            user.name.toLowerCase().includes(query.toLowerCase())
            //user.name.toLowerCase().startsWith(query.toLowerCase())
          );

          renderUsers(filtered); // Separation of concerns
          statusEl.textContent = `Found ${filtered.length} result(s)`;
        } catch (error) {
          // Abort errors are expected — ignore them
          if (error.name === "AbortError") {
            return;
          }

          statusEl.textContent = "Error loading data";
        }
      }

      // Debounced input handler
      input.addEventListener("input", () => {
        const query = input.value.trim();

        // Clear previous debounce timer
        clearTimeout(debounceTimer);

        if (!query) {
          resultsEl.innerHTML = "";
          statusEl.textContent = "Idle";
          return;
        }

        // Debounce: wait 400ms after user stops typing
        debounceTimer = setTimeout(() => {
          searchUsers(query);
        }, 2000);
      });
    </script>
  </body>
</html>