<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Project 1 — Async Data Loader</title>
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family: system-ui, Arial;
        margin: 0;
        padding: 24px;
        background: #0b1020;
        color: #e9eefc;
      }
      .app {
        max-width: 900px;
        margin: 0 auto;
      }
      .card {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 16px;
        padding: 16px;
      }
      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
      }
      button {
        border: 0;
        border-radius: 12px;
        padding: 10px 14px;
        cursor: pointer;
        background: #4f7cff;
        color: white;
        font-weight: 600;
      }
      button.secondary {
        background: rgba(255, 255, 255, 0.12);
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
        margin-top: 12px;
      }
      .user {
        padding: 12px;
        border-radius: 14px;
        background: rgba(0, 0, 0, 0.18);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .muted {
        opacity: 0.75;
      }
      .spinner {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.25);
        border-top-color: white;
        animation: spin 0.9s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .status {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 12px;
      }
      .toast {
        position: fixed;
        right: 18px;
        bottom: 18px;
        background: rgba(0, 0, 0, 0.55);
        border: 1px solid rgba(255, 255, 255, 0.18);
        padding: 12px 14px;
        border-radius: 14px;
        backdrop-filter: blur(10px);
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <div class="card">
        <!--──────────────────────────────────────────────
      │ Code Overview
      │ Purpose        → Fetch real data with async/await + handle errors + retry
      │ Layout         → Single HTML file (UI + JS)
      │ Use Cases      → API call patterns, loading state, try/catch, retry UX
      │ Key Properties → fetch(), async/await, try/catch, finally
      └──────────────────────────────────────────────-->
        <h2 style="margin: 0 0 8px">Async Data Loader</h2>
        <p class="muted" style="margin: 0 0 14px">
          Loads users from a public API. Shows loading, errors, and retry.
        </p>

        <div class="row">
          <button id="btnLoad">Load Users</button>
          <button id="btnRetry" class="secondary" disabled>Retry</button>
          <span class="muted" id="meta"></span>
        </div>

        <div class="status" id="status" style="display: none">
          <div class="spinner"></div>
          <div>Loading…</div>
        </div>

        <div
          id="error"
          class="muted"
          style="margin-top: 12px; display: none"
        ></div>
        <div class="grid" id="grid"></div>
      </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
      const UI = {
        btnLoad: document.getElementById("btnLoad"),
        btnRetry: document.getElementById("btnRetry"),
        status: document.getElementById("status"),
        error: document.getElementById("error"),
        grid: document.getElementById("grid"),
        meta: document.getElementById("meta"),
        toast: document.getElementById("toast"),
      };

      // Small helper to show a toast message (pure UI utility)
      function showToast(message) {
        UI.toast.textContent = message;
        UI.toast.style.display = "block";
        setTimeout(() => (UI.toast.style.display = "none"), 3200);
      }

      // Render users to UI
      function renderUsers(users) {
        UI.grid.innerHTML = users
          .map(
            (u) => `
        <div class="user">
          <div style="font-weight:700;">${u.name}</div>
          <div class="muted">@${u.username}</div>
          <div style="margin-top:8px;" class="muted">${u.email}</div>
          <div style="margin-top:8px;" class="muted">${u.phone}</div>
        </div>
      `
          )
          .join("");
      }

      // A single async function that handles the full flow:
      // loading UI → fetch → render → error handling → cleanup
      async function loadUsers() {
        UI.btnLoad.disabled = true;
        UI.btnRetry.disabled = true;
        UI.error.style.display = "none";
        UI.grid.innerHTML = "";
        UI.status.style.display = "flex";
        UI.meta.textContent = "";

        try {
          // Real API call (works in browser)
          const res = await fetch("https://jsonplaceholder.typicode.com/users");

          // If the server responded with an error code, treat it as an error
          if (!res.ok) throw new Error("Server responded with an error.");

          const users = await res.json();
          //Parsing json to obj
          renderUsers(users);//Separation of Ui and Fetching logic
          UI.meta.textContent = `Loaded ${users.length.toLocaleString()} users`;
          showToast("✅ Loaded successfully");
        } catch (err) {
          // Any network/server parsing errors end up here
          UI.error.textContent = `❌ Failed to load users: ${err.message}`;
          UI.error.style.display = "block";
          UI.btnRetry.disabled = false;
          showToast("❌ Load failed");
        } finally {
          // Always runs (success or error)
          UI.status.style.display = "none";
          UI.btnLoad.disabled = false;
        }
      }

      UI.btnLoad.addEventListener("click", loadUsers);
      UI.btnRetry.addEventListener("click", loadUsers);
    </script>
  </body>
</html>