
select * from Accounts
select * from Transactions


Declare @ErrorNum int ;
Declare @Amount int ;


set @Amount = 300;



BEGIN TRANSACTION;

BEGIN TRY

	
    -- Subtract $100 from Account 1

	if @Amount < (select Balance from Accounts where AccountID =1)
    UPDATE Accounts SET Balance = Balance - @Amount WHERE AccountID = 1;
	
	else
		Begin
			Throw 55000 , 'Error to Transact Money , your Balance is not enough' , 23 ;
		End

    -- Add $100 to Account 2
    UPDATE Accounts SET Balance = Balance + @Amount WHERE AccountID = 2;
	
    -- Log the transaction
    INSERT INTO Transactions (FromAccount, ToAccount, Amount, Date) VALUES (1, 2, 100, GETDATE());

    -- Commit the transaction
    COMMIT;
END TRY

BEGIN CATCH
    -- Rollback in case of error
    ROLLBACK;
    -- Error handling code here
	SELECT 
            ERROR_NUMBER() AS ErrorNumber,
            ERROR_MESSAGE() AS ErrorMessage,
			ERROR_State() AS ErrorState; 
END CATCH;